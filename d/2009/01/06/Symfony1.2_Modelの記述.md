---
title: Symfony1.2 Modelの記述
aliases:
  - Symfony1.2_Modelの記述
tags:
  - d/2023/03/03
  - n/PGM/PHP/Symfony/v1.2/Model
  - n/PGM/DB/MySQL/v5.1
---

- 2009年01月06日
- symfony1.2
- MySQL5.1

はじめに
================================================================================
symfony の Model はデータベースと切っても切れない関係なのでここにメモ

モデルの生成手順
================================================================================
symfony にはモデルの生成手順が2パターンあるっぽ。

- モデル定義YAML→モデル生成→テーブル生成パターン
- 現存のテーブル→モデル生成パターン

symfony の O/R マッパーは Rails のような動的タイプではなくジェネレートタイプなので、荒波を乗りこなしていくような豪快な構築はできないっぽいね



モデル定義→モデル生成→テーブル生成
================================================================================
Rails っぽくこの方針でやってみる。

データベース作成
--------------------------------------------------------------------------------
どっちのパターンにしてもデータベースはあらかじめ作っておかないといけないので作っておく。こりゃなんで作ってもいい

設定ファイルの記述
--------------------------------------------------------------------------------

- propel.ini
- database.yml

を適当に自分のDBに合わせて書く

デフォルトはMySQL向けの設定になっているが

```
$ symfony configure:database mysql://localhost/db_name
```

こういうコマンドで各種DB用に書き換えることができる


モデルの定義を作る
--------------------------------------------------------------------------------
`schema.yml` ファイルにモデルの定義を書きます。
`user` というモデルを定義します。`user` はテーブルの名前で、`phpName` で指定している `User` はクラス名になります。

```yaml
propel:
  user:
    _attributes: { phpName: User }
    id:
    name:       varchar(255)
    age:        integer
    created_at:
```

こんな風に書く


モデルを生成
--------------------------------------------------------------------------------
コマンドドン

```
$ symfony propel-build-model
```

プロジェクトディレクトリの lib 以下にモデルが生成されたことがわかります。

`schema.yml` で設定した名前でモデルが作られています。Peerとつくやつはテーブルからオブジェクトを掘り出すために使われます。

Rails ではここらへんは通常メソッドとクラスメソッドで1個のモデルに詰め込まれているわけですが、symfony は格納されているデータを操作するモデルともうすでに存在するレコードをモデル化するメソッドが分離されています。

このへんは大クラス主義とかの思想の違いですね。


モデルに対応するテーブルを生成
--------------------------------------------------------------------------------
コマンドドン

```
$ symfony propel-build-sql
```

プロジェクトディレクトリのdate/sql以下にSQLが生成されたことがわかります。

SQLを実行してテーブルを生成
コマンドドン

```
$ symfony propel-insert-sql
```


モデルによるレコード操作（検索以外）
================================================================================
新規レコード作成
--------------------------------------------------------------------------------
new set save の3点セットでOK

```php
$a = new User();
$a->setName("hoge");
$a->setAge(10);
$a->save();
```

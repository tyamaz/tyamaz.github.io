---
title: Symfony 1.2 Action の記述
aliases:
  - Symfony_1.2_Action_の記述
tags:
  - d/2022/06/01
  - n/PGM/PHP/Symfony/v1.2/Action
  - m/未完
---

- 注 古い情報
- 2009年01月06日
- Symfony1.2

モジュール生成と同時生成
================================================================================
モジュール生成によって、Action の雛形も同時生成される。場所はたぶん↓ここらへんにある

```
D:\hogehoge\apps\piyo\modules\fuga\actions\actions.class.php
```

中を見てみるともう一応書かれているのでアクセスしてみる

```
http://hogehoge/piyo_dev.php/fuga/index
```


確認できた

URL による Action の呼び出し対応
================================================================================
このように

```
http://ドメイン/アプリ名/モジュール名/Action名
```

のようにディレクトリ形式でアクセスできる

アクション名は `actions.class.php` 中の

```php
public function executeIndex(sfWebRequest $request){}
```

の `executeIndex` の `Index` → `index` という感じで対応する



アプリ名のデフォルト
--------------------------------------------------------------------------------
プロジェクト中に最初に作ったアプリ名はデフォルト値に割り当てられていて、どんなアプリ名で作ろうが `index.php` という名前でアクセスすることができる


アプリ名の省略
--------------------------------------------------------------------------------
たぶんほとんどの用途では1プロジェクト1アプリケーションになっているハズなので↑での `index.php` すら省略することができる。つまり、アプリが一個ならば

```
http://ドメイン/モジュール名/Action名
```

で呼び出すことができる。


テンプレートの呼び出し
================================================================================
ビューであるテンプレートを呼び出す場合は通常何も記述しなければ、名前に対応するテンプレートが自動的に呼び出される

Actionクラスに

```php
public function executeShow(){}
```

という中身のないActionを追加してみる。

テンプレートは

```
D:\hogehoge\apps\piyo\modules\fuga\templates
```

あたりにある

デフォルトで一個 `indexSuccess.php` というテンプレートが用意されている（中身空っぽ）

ここでこいつに習って `showSuccess.php` というファイルを作る。

中に

```php
showshowshow
```

とだけ書いておきましょう

そうして画面からアクセスすると画面に `showshowshow` の文字が表示されると思います。



テンプレートへの値の送り込み
================================================================================
Action で得た値をテンプレートへ送り込むには、Action 中で

```php
$this->hoge = "ほげ";
```

と自分自身のプロパティに突っ込んでおくとテンプレート中で

```php
<?php echo $hoge; ?>
```


同名の変数として取り出すことができる。

↓と書いても同様なことができる

```php
$this->setVar('hoge', 'ほげ');
```


リクエストからのパラメータの取り出し
================================================================================
※ コンテンツ消失 2022-06-01 確認 ↓このコンテンツが無い

```
[[PHP/symfony1.2/Actionの記述/画面からのパラメータの受け取り]]
```

流れの制御
================================================================================
別アクションへ飛ばす（URL変化無し）
--------------------------------------------------------------------------------

```php
$this->forward('モジュール名', 'Action名');
```

別アクションへリダイレクト（URL変化有り）
--------------------------------------------------------------------------------

```php
$this->redirect('モジュール名/Action名');
```

別URLへリダイレクト（URL変化有り）
--------------------------------------------------------------------------------

```php
$this->redirect('http://hogehoge.com/');
```


テンプレートの選択
================================================================================
Action の return を明示的に指定することによってテンプレートを選ぶことができます。

成功した場合
--------------------------------------------------------------------------------

```php
return sfView::SUCCESS;
```

と返すと成功テンプレートを Symfony が選択してくれます。

`executeIndex` という Action ならば選択されるテンプレートは `indexSuccess.php` という名前になります。

デフォルトは成功なので、明示的に書かなくても成功テンプレートは選択される。

失敗した場合
--------------------------------------------------------------------------------

```php
return sfView::ERROR;
```

と返すと失敗テンプレートを `Symfony` が選択してくれます。

`executeIndex` という Action ならば選択されるテンプレートは `indexError.php` という名前になります。

選択したくない場合
--------------------------------------------------------------------------------
テンプレートという機構を用いず、Action の中ですべての HTML を組み立てることもできます。

こんな感じ↓

```php
$this->getResponse()->setContent("<html><body>hoge</body></html>");
```

こういう場合にはテンプレートを抑制して、組み立てたレスポンスを優先させいたいです。

```php
 return sfView::NONE;
```

をリターンすることでテンプレートによる HTML の描画を抑制することができます。



独自のテンプレートの選択
--------------------------------------------------------------------------------
任意の文字列を戻すことによって独自のテンプレート分岐も可能になります

```php
return "piyo";
```

`executeIndex` という Action ならば選択されるテンプレートは `indexPiyo.php` という名前になります。



共通メソッド
================================================================================
Action実行前
--------------------------------------------------------------------------------
`preExecute` というメソッドを作るとモジュール内の Action を実行する前の共通的処理を実行することができます。

```php
public function preExecute(){}
```


Action実行後
--------------------------------------------------------------------------------
`postExecute` というメソッドを作るとモジュール内の Action を実行した後の共通的処理を実行することができます。

```php
public function postExecute(){}
```



